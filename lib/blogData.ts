import { BlogPost } from "./../types/types"

// ðŸ”¥ BLOG POST REGISTRY - Add new blog posts here!
export const blogPosts: BlogPost[] = [
  // {
  //   slug: "a-homeland-shaped-by-the-river-of-the-south-wind",
  //   title: "A Homeland Shaped by the River of the South Wind",
  //   description: "An interactive exploration of Indigenous life along the Arkansas River, featuring the diverse nations that called this waterway home.",
  //   publishDate: "2025-06-15",
  //   readTime: "8 min read",
  //   category: "History & Culture",
  //   featured: false,
  //   tags: ["Indigenous History", "Arkansas River", "Interactive Story", "Cultural Heritage"],
  //   excerpt: "Discover the rich tapestry of Indigenous nations that thrived along the Arkansas River, from the Ute in the headwaters to the Quapaw at its confluence with the Mississippi. An immersive journey through time featuring AI-powered storytelling.",
    // contentSource: 'static'
  // },
  {
    slug: "bodys-gatekeeper",
    title: "The Body's Gatekeeper",
    description: "Loss of bowel control is a serious medical condition, not a personal failing. Effective treatments exist. The most important step is to break the silence and talk to a healthcare provider.",
    publishDate: "2025-06-16",
    readTime: "5 min read",
    category: "Biology",
    featured: false,
    tags: ["Human Anatomy", "Health & Wellness", "Digestive System"],
    excerpt: "A Visual Guide to Understanding Bowel Control: Gas vs. Stool. The Anatomy of Continence Meet the key players responsible for keeping you in control.",
    contentSource: 'static'
  },
  {
    slug: "centenarian-athletes-an-interactive-infographic",
    title: "Centenarian Athletes An Interactive Infographic",
    description: "A Visual Guide to amazing centenarian athletes that held the record as world's fastest centenarian.",
    publishDate: "2025-07-16",
    readTime: "5 min read",
    category: "Athletics",
    featured: false,
    tags: ["Athletes", "Sports", "Athletics", "Longevity"],
    excerpt: "Ageless Wonders. Discover the incredible stories of centenarian athletes who defy the limits of age.",
    contentSource: 'static'
  },
  {
    slug: "diaphragmatic-breathing",
    title: "The Power of Breath: A Guide to Diaphragmatic Breathing",
    description: "More Than Just a Deep Breath. Often called 'belly breathing,' this is the practice of engaging your diaphragm, a large muscle at the base of your lungs designed to do ~80% of the work of breathing. It contrasts with shallow 'chest breathing,' which uses smaller neck and shoulder muscles, leading to tension and inefficiency. Learning this technique is about re-learning your body's natural, optimal way to breathe.",
    publishDate: "2025-07-08",
    readTime: "5 min read",
    category: "Voiceover",
    featured: true,
    tags: ["Breathing", "Voiceover", "Health", "Longevity"],
    excerpt: "Unlock health, longevity, and vocal excellence by mastering your body's most fundamental rhythm.",
    contentSource: 'static'
  },
  {
    slug: "endocannabinoid-system-curriculum-infographic-sources",
    title: "The Endocannabinoid System: A Comprehensive Educational Curriculum",
    description: "This curriculum provides evidence-based education on the endocannabinoid system, designed for healthcare professionals, researchers, and wellness practitioners seeking to integrate ECS knowledge into their practice.",
    publishDate: "2025-06-07",
    readTime: "5 min read",
    category: "Endocannabinoid System",
    featured: true,
    tags: ["Science", "Endocannabinoid System", "Health", "Longevity", "Fitness", "Educatoin", "Neurology"],
    excerpt: "This curriculum provides evidence-based education on the endocannabinoid system, designed for healthcare professionals, researchers, and wellness practitioners seeking to integrate ECS knowledge into their practice.",
    contentSource: 'static'
  },
  {
    slug: "enduring-power-of-hoodoo",
    title: "The Enduring Power of Hoodoo",
    description: "A spiritual tradition of resistance, resilience, and empowerment.",
    publishDate: "2025-07-07",
    readTime: "5 min read",
    category: "Spirituality",
    featured: true,
    tags: ["Spirituality", "Africa", "USA", "African-American", "Rootwork", "Conjure", "Hoodoo", "Tradition", "History"],
    excerpt: "Hoodoo, also known as Rootwork or Conjure, is an African-American spiritual tradition focused on personal empowerment and achieving tangible results in everyday life. It is a system of folk magic, not an organized religion.",
    contentSource: 'static'
  },
  {
    slug: "exodus",
    title: "An Exodus in the Land of Promise",
    description: "The Great Migration of African Americans, 1910-1970.",
    publishDate: "2025-07-07",
    readTime: "10 min read",
    category: "US History",
    featured: false,
    tags: ["US History", "World History", "USA", "African-American", "Harlem Renaissance", "Migration", "Refugees", "Jim Crow South", "History"],
    excerpt: "The Great Migration was a courageous act of agency by six million African Americans to escape the oppressive Jim Crow South. They fled a system of legal segregation, political disenfranchisement, economic exploitation through sharecropping, and the constant terror of racial violence. As one migrant wrote, they sought to go 'where a man is a man.'",
    contentSource: 'static'
  },
  // {
  //   slug: "free-spaced-repetition-scheduler",
  //   title: "Free Spaced Repetition Scheduler (FSRS)",
  //   description: "FSRS is a sophisticated algorithm based on the DSR (Difficulty, Stability, Retrievability) model of memory. It provides a powerful, data-driven method for creating highly personalized flashcard review schedules.",
  //   publishDate: "2025-07-07",
  //   readTime: "5 min read",
  //   category: "Learning",
  //   featured: true,
  //   tags: ["Learning Cycle", "Learning Cycle"],
  //   excerpt: "FSRS is a sophisticated algorithm based on the DSR (Difficulty, Stability, Retrievability) model of memory. It provides a powerful, data-driven method for creating highly personalized flashcard review schedules.",
    // contentSource: 'static'
  // },
  {
    slug: "interactive-indiana-corvid-species-analysis",
    title: "Interactive Corvid Analysis",
    description: "An AI-Enhanced Infographic for Indiana Species",
    publishDate: "2025-05-07",
    readTime: "5 min read",
    category: "Birds",
    featured: false,
    tags: ["Nature", "Birds", "Animals"],
    excerpt: "An AI-Enhanced Infographic for Indiana Species",
    contentSource: 'static'
  },
  {
    slug: "making-sense-of-statistics",
    title: "Making Sense of Statistics",
    description: "A Guide to Understanding & Explaining Data",
    publishDate: "2025-05-07",
    readTime: "7 min read",
    category: "Statistics",
    featured: false,
    tags: ["Statistics", "Math", "Critical Thinking"],
    excerpt: "Statistics help us describe data and draw inferences. These are the building blocks.",
    contentSource: 'static'
  },
  {
    slug: "lester-wright-sr-the-man-who-outran-time",
    title: "Lester Wright Sr.: The Man Who Outran Time",
    description: "The Man Who Outran Time",
    publishDate: "2025-06-20",
    readTime: "5 min read",
    category: "Centenarian",
    featured: false,
    tags: ["Centenarian", "Athletics"],
    excerpt: "Shattered the 100m world record for the M100 age group with a time of 26.34 seconds.",
    contentSource: 'static'
  },
  {
    slug: "scientific-study-infographic",
    title: "Understanding Scientific Studies",
    description: "The design of a study determines the strength of its conclusions. Understanding the type is the first step to critical appraisal.",
    publishDate: "2025-07-20",
    readTime: "5 min read",
    category: "Science",
    featured: false,
    tags: ["Science", "Critical Thinking"],
    excerpt: "The design of a study determines the strength of its conclusions. Understanding the type is the first step to critical appraisal.",
    contentSource: 'static'
  },
  {
    slug: "sacred-act-of-burning-hair",
    title: "The Sacred Act of Burning Hair",
    description: "An interactive infographic tracing a profound spiritual practice from its African origins to its enduring presence in the diaspora.",
    publishDate: "2025-03-29",
    readTime: "5 min read",
    category: "Rituals",
    featured: false,
    tags: ["Culture", "Rituals"],
    excerpt: "An interactive infographic tracing a profound spiritual practice from its African origins to its enduring presence in the diaspora.",
    contentSource: 'static'
  },
  {
    slug: "skeptics-guide-to-statistics",
    title: "The Skeptics Guide to Statistics",
    description: "How Data Can Be Misused & What to Look For. Misinformation isn't always about fake data. Often, it's about presenting real data in a misleading way. Here are the most common traps.",
    publishDate: "2025-01-10",
    readTime: "5 min read",
    category: "Statistics",
    featured: false,
    tags: ["Statistics", "Critical Thinking", "Math"],
    excerpt: "Misinformation isn't always about fake data. Often, it's about presenting real data in a misleading way. Here are the most common traps.",
    contentSource: 'static'
  },
  // {
  //   slug: "centenarian-athletes-an-interactive-infographic-times",
  //   title: "Centenarian Athletes Times: An Interactive Infographic",
  //   description: "A Visual Guide to amazing centenarian athletes that held the record as world's fastest centenarian.",
  //   publishDate: "2025-07-17",
  //   readTime: "5 min read",
  //   category: "Athletics",
  //   featured: false,
  //   tags: ["Athletes", "Sports", "Athletics", "Longevity"],
  //   excerpt: "Ageless Wonders. Discover the incredible stories of centenarian athletes who defy the limits of age.",
    // contentSource: 'static'
  // },
  // {
  //   slug: "bowel-as-a-barometer",
  //   title: "The Bowel as a Barometer",
  //   description: "Your Gut's Daily Report Card on Health, Disease Risk, and Longevity.",
  //   publishDate: "2025-06-18",
  //   readTime: "5 min read",
  //   category: "Biology",
  //   featured: false,
  //   tags: ["Human Anatomy", "Health & Wellness", "Digestive System"],
  //   excerpt: "The Gut-Health Bridge. Your bowel habits shape the trillions of microbes in your gut, which in turn influence your entire body.",
    // contentSource: 'static'
  // }

  // ðŸ”¥ TO ADD A NEW BLOG POST:
  // 1. Create a folder in /blog/[your-blog-title-slug]/
  // 2. Add your page.tsx file to that folder
  // 3. Add an entry here with the same slug
  // 4. The blog listing will automatically pick it up!
]

// NEW: Enhanced functions that merge static and CMS posts
export async function getAllBlogPosts(includeUnpublished = false): Promise<BlogPost[]> {
  try {
    // Fetch CMS posts
    const response = await fetch(`/api/blog?status=${includeUnpublished ? 'all' : 'published'}`, {
      // Add cache control if needed
      cache: 'no-store' // or 'force-cache' with revalidation
    })
    
    let cmsPosts: BlogPost[] = []
    if (response.ok) {
      const data = await response.json()
      cmsPosts = data.posts || []
    }

    // Combine with static posts
    const allPosts = [
      ...cmsPosts,
      ...blogPosts.map(post => ({
        ...post,
        status: 'published' as const
      }))
    ]

    // Sort by publish date (newest first)
    return allPosts.sort((a, b) => 
      new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime()
    )
  } catch (error) {
    console.error('Failed to fetch blog posts:', error)
    // Fallback to static posts only
    return blogPosts.map(post => ({
      ...post,
      status: 'published' as const
    }))
  }
}

// Enhanced helper functions
export const getFeaturedPosts = async (): Promise<BlogPost[]> => {
  const allPosts = await getAllBlogPosts()
  return allPosts.filter(post => post.featured)
}

export const getPostsByCategory = async (category: string): Promise<BlogPost[]> => {
  const allPosts = await getAllBlogPosts()
  return allPosts.filter(post => post.category === category)
}

export const getAllCategories = async (): Promise<string[]> => {
  const allPosts = await getAllBlogPosts()
  return Array.from(new Set(allPosts.map(post => post.category)))
}

// Updated to check both static and CMS posts
export const getPostBySlug = async (slug: string): Promise<BlogPost | null> => {
  // First check static posts
  const staticPost = blogPosts.find(post => post.slug === slug)
  if (staticPost) {
    return { ...staticPost, status: 'published' as const }
  }

  // Then check CMS posts
  try {
    const response = await fetch(`/api/blog/${slug}`)
    if (response.ok) {
      const data = await response.json()
      return data.post
    }
  } catch (error) {
    console.error('Failed to fetch CMS post:', error)
  }

  return null
}

// NEW: Get posts with photos for admin interface
export const getPostsWithPhotos = async (): Promise<BlogPost[]> => {
  const allPosts = await getAllBlogPosts(true) // Include unpublished for admin
  return allPosts.filter(post => 
    post.photoIds && post.photoIds.length > 0 || post.featuredImage
  )
}

// NEW: Get usage statistics
export const getBlogStats = async () => {
  const allPosts = await getAllBlogPosts(true)
  
  return {
    total: allPosts.length,
    published: allPosts.filter(p => p.status === 'published').length,
    drafts: allPosts.filter(p => p.status === 'draft').length,
    static: allPosts.filter(p => p.contentSource === 'static').length,
    cms: allPosts.filter(p => p.contentSource === 'cms').length,
    withPhotos: allPosts.filter(p => p.photoIds?.length || p.featuredImage).length,
    categories: await getAllCategories()
  }
}

// Synchronous versions for existing compatibility (only static posts)
export const getFeaturedPostsSync = () => blogPosts.filter(post => post.featured)
export const getPostsByCategorySync = (category: string) => blogPosts.filter(post => post.category === category)
export const getAllCategoriesSync = () => Array.from(new Set(blogPosts.map(post => post.category)))
export const getPostBySlugSync = (slug: string) => blogPosts.find(post => post.slug === slug)

// Export static posts for backward compatibility
export { blogPosts as staticBlogPosts }